jQuery(document).ready(function () {
    jQuery("#start_import").on('click', function (e) {
        e.preventDefault();
        var self = jQuery(this);
        var infoBlock = jQuery('.import_preloader_text').css('display', 'block');
        jQuery('.import_preloader_text').html('Loading. Wait few minutes...');
        jQuery('.import_preloader_text').removeClass('hide_theme_preloader_text');
        var filename = jQuery(this).attr('data-filename');
        jQuery.post(sysvar.adminajax, {filename: filename, action: 'start_import'}, function (data) {             
        }).done(function (data) {
            console.log(data);
            if (!jQuery.isPlainObject(data)) {
                var matches = data.match('\({.*\})');
                if (matches){
                    data = matches[1];
                }
            }
            jQuery('.import_preloader').addClass('hide_theme_preloader');
            jQuery('.import_preloader_text').text('Import complete.');
            infoBlock.text('');
            response = jQuery.parseJSON(data);
            if (typeof (response) != 'undefined') {
                if (response.hasOwnProperty('status')) {
                    switch (response.status) {
                        case 'success':
                            self.remove();
                            infoBlock.html(response.text);
                            break;
                        case 'error':
                            infoBlock.html('<font color="red">' + response.text + '</font>');
                            break;
                        default:
                            break;
                    }
                }
            }
        });
    });
});